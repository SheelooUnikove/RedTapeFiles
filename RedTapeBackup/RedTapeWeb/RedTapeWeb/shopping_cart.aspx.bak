<%@ Page Title="redtape | shopping_cart" Language="C#" MasterPageFile="~/MasterRedTape.Master" AutoEventWireup="true" CodeBehind="shopping_cart.aspx.cs" Inherits="RedTapeWeb.shopping_cart" %>
<asp:Content ID="Content1" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
    <div class="container">
	<div class="shpng_cart">
        <h2 id="msg" runat="server"></h2>
        <div id="cartdiv" runat="server">
		<ul>
			<li class="shpng_cart">
				<ul>
					<li>item</li>
					<li>product name</li>
					<li>qty</li>
					<li>price</li>
					<li>subtotal</li>
				</ul>
			</li>
           <asp:Repeater ID="rpt_AddtocartList" runat="server">
               <ItemTemplate>
			<li class="shpng_cart" id="<%#Eval("viewId") %>">
				<ul>
					<li><img src="<%#Eval("imgUrl") %>" onclick="openproductpage(<%#Eval("productId") %>);" /></li>
					<li onclick="openproductpage(<%#Eval("productId") %>);"><%#Eval("productName") %></li>				
                    <li><input id="pro<%#Eval("viewId") %>" type="number" class="qty" min="1" max="99" maxlength="2" value="<%#Eval("qty") %>"  onchange="updateproqty(<%#Eval("viewId") %>,<%#Eval("salePrice") %>)" onkeypress="return numbersonly(event)"/></li> 
					<li><span>&#x20B9; </span><%#Eval("salePrice") %></li>                                      
					<li ><span>&#x20B9; </span><span id="sub<%#Eval("viewId") %>" class="sub"><%#Eval("subTotal") %></span></li>
					<li><img  src="images/website/shopping_cart/img2.png" onclick="deleteFromCartList(<%#Eval("viewId") %>,<%#Eval("productId") %>,<%#Eval("attrId") %>,<%#Eval("subTotal") %>);"  /></li>
				</ul>
			</li>
               </ItemTemplate>
            </asp:Repeater>
		</ul>

		<div class="cart_foter">
			<div class="cart_net">total amount</div>
			<div class="cart_total"><span>&#x20B9; </span><span  runat="server" id="lbl_totalAmount"></span></div>
		</div>
		</div>
		<div class="cart_hpl_fotr">
			<div class="hlp_cntct">Need Help? Contact us 011-26950499</div>
			<div class="cart_plc_order" id="cart_plc_order" runat="server" onclick="plcorder();">place order</div>
			<div class="cart_cntun_shpng" onclick="window.open('Default.aspx','_self',false)">continue shopping</div>
		</div>			
	</div>	
</div>    

    <script>        
        function updateproqty(viewId, salePrice) {          
            RedTapeWeb.Services.ProductCats.UpdateQntProduct(viewId, $('#pro' + viewId).val(), successupdateproqty, fail);

            function successupdateproqty(result) {
                if (result != "") {
                    $('#sub' + viewId).html(parseInt(salePrice) * parseInt($('#pro' + viewId).val()));
                    var total = 0;
                    $('.sub').each(function () {
                        total += parseInt(this.innerHTML, 10);
                    });
                    $('#ctl00_ContentPlaceHolder1_lbl_totalAmount').html(total);
                }
            }
        }        
        function plcorder() {
            var UId = '<%=Session["MembershipNo"] %>';
            if (UId.toString() == "") {
                window.open('login_signup.aspx?returnurl=yes', '_self', false);
            }
            else {
                window.open('order_now.aspx', '_self', false);
            }           
        }

        function deleteFromCartList(viewid, productId, attrId, Amount) {
            Amount = parseInt($('#sub' + viewid).html());
            var UId = '<%=Session["MembershipNo"] %>';
            if (UId.toString() == "") {
                UId = 0;
            }
            RedTapeWeb.Services.ProductCats.SaveUserViewProducts(productId,attrId,UId,0,0,success,fail);
            function success()
            {
                $('#' + viewid).remove();
                var balance = parseInt($('#ctl00_ContentPlaceHolder1_lbl_totalAmount').html()) - parseInt(Amount);
                $('#ctl00_ContentPlaceHolder1_lbl_totalAmount').html(balance);
                var count = $('#ctl00_lbl_CartCount').html().replace('(', '').replace(')', '');
                $('#ctl00_lbl_CartCount').html('(' + (parseInt(count) - 1) + ')');
                count = $('#ctl00_lbl_CartCount').html().replace('(', '').replace(')', '');
                if (count == 0) {
                    $('#ctl00_ContentPlaceHolder1_cartdiv').hide();
                    $('.cart_plc_order').hide();
                    $('#ctl00_ContentPlaceHolder1_msg').html("There are no items in this cart.");
                }
            }
            function fail(error)
            {
                alert(error);
            }
        }
    </script>
    <style>
        .qty {height: 22px;text-align: center; width: 50px; border:solid 1px;}
    </style>
</asp:Content>
